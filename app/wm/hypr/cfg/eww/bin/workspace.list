#!/usr/bin/env bash
set -euo pipefail

spaces() {
	WORKSPACE_WINDOWS=$(hyprctl workspaces -j | jq 'map({key: .id | tostring, value: .windows}) | from_entries')
	seq 1 6 | jq --argjson windows "${WORKSPACE_WINDOWS}" --slurp -Mc 'map(tostring) | map({id: ., icon: ("y" + .), windows: ($windows[.]//0)})' |
		sed 's/y1//
			 s/y2/󰈹/
			 s/y3//
			 s/y4/󰭹/
			 s/y5/󰊖/
			 s/y6//'
}

spaces
socat -u "UNIX-CONNECT:/tmp/hypr/$HYPRLAND_INSTANCE_SIGNATURE/.socket2.sock" - | while read -r _; do
	spaces
done
